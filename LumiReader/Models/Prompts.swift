//
//  Prompts.swift
//  LumiReader
//
//  Created by jolin on 2024/6/3.
//

import Foundation

// MARK: - 方案定义
/// 【更新】仅为批量总结定义提示词方案
public enum BatchPromptScheme: String, CaseIterable, Identifiable {
    case normal = "标准版"
    case tts = "语音版"
    
    public var id: String { self.rawValue }
}

// Define shared default prompts
public struct Prompt: Identifiable, Codable, Hashable {
    public let id: UUID
    public var title: String
    public var content: String
    public let createdAt: Date

    public init(id: UUID = UUID(), title: String, content: String, createdAt: Date = Date()) {
        self.id = id
        self.title = title
        self.content = content
        self.createdAt = createdAt
    }
}

public extension Prompt {
    
    // MARK: Helper Functions
    
    /// 【更新】根据选择的批量总结方案，返回对应的默认提示词
    static func defaultBatchSummary(for scheme: BatchPromptScheme) -> String {
        switch scheme {
        case .normal:
            return DEFAULT_BATCH_SUMMARY_PROMPT_NORMAL
        case .tts:
            return DEFAULT_BATCH_SUMMARY_PROMPT_TTS
        }
    }

    // Default AI prompts (example)
    static let DEFAULT_PRESET_PROMPTS: [Prompt] = [
        // 科普[x]
        Prompt(title: "科普[x]", content: "大白话科普一下:\n[x]"),
        // 展开[x]
        Prompt(title: "展开[x]", content: "对以下内容请用大白话展开说说:\n[x]"),
        // 列出案例
        Prompt(title: "故事案例", content: """
        请你用大白话，给我讲讲文中主要有哪些有意思的故事或案例？这些故事或案例给我们带来了什么启发，或者教会了我们什么道理？ 语言要简单易懂，就像给朋友讲事情一样。
        """),
        // 列出数据
        Prompt(title: "数据专家", content: """
请你充当数据提取专家，帮我从这篇文章中找出所有重要的数字、百分比、比例、金额、时间、数量等关键统计信息。

请以**以下规范的格式**，清晰地展示这些数据。

**输出格式规范：**

1.  **内容呈现：**
    *   每个数据点请采用**编号列表**（例如：1. 2. 3.）。
    *   每个编号点都应是**一句简洁精炼的描述**，直接包含原文中或总结出的数值信息及其紧密关联的上下文。
    *   请务必对句子中的**具体数值**进行**加粗字体**强调。

**示例格式（AI请严格按照以下格式输出）：**

1.  2023年第三季度市场调研报告显示，智能穿戴设备的季度采纳率同比增长了**25%**。

2.  根据公司2022年财报，当年研发部门在人工智能新应用上的投入达到了**5000万元**。

3.  一项针对小微企业的税收优惠政策，平均需要**3年**时间才能在当地经济中显现出显著的带动作用。

"""),
        // 列出金句
        Prompt(title: "金句大师", content: """
我需要你从这篇文章中，找出那些让你眼前一亮、拍案叫绝的“思想火花”，也就是那些让人印象深刻的**金句和精彩观点**。

请你像一个宝藏猎人一样，找出那些文章的**“点睛之笔”**，它们可能是：
*   作者的独到见解，让人茅塞顿开。
*   一句言简意赅，却充满哲理的话。
*   对事物本质的深刻洞察。

请以**以下规范的格式**，清晰地展示这些“宝藏”。

**输出格式规范：**

1.  **内容呈现：**
    *   每个“思想火花”点请采用**编号列表**（例如：1. 2. 3.）。
    *   每个编号点都应包含以下两部分内容，并**清晰分行展示**：
        *   **第一行（核心内容）：** [此处直接是金句或概括的精彩观点。如果是**金句**，请**完整引用原文**；如果是**精彩观点**，请用**简洁大白话概括其核心思想**。请务必对该内容使用**加粗字体**强调。]
        *   **第二行（解读）：** [以“解读：”开头，简要说明这个金句或观点为什么让你觉得精彩，或者它为何能成为“点睛之笔”，带来“眼前一亮”的感觉。]

**示例格式（AI请严格按照此格式输出）：**

1.  **真正的自由不是为所欲为，而是有所不为。**
    解读：这句金句颠覆了我们对自由的传统理解，指出真正的自由在于懂得取舍和自律，是更高层次的智慧，让人豁然开朗。

2.  **复杂问题的解决方案往往隐藏在被忽视的简单细节中。**
    解读：我们常倾向于寻找复杂的大方案，但这个观点提醒我们，真正的突破口可能在于那些我们习以为常、甚至觉得不重要的细节，让人觉得“原来如此”。

3.  **在信息过载的时代，学会遗忘比记忆更重要。**
    解读：这反直觉的观点强调了在海量信息中筛选和放弃的必要性，让人意识到“减法”思维在知识管理中的重要性，非常实用且具有启发性。
"""),
        // 新颖见解
        Prompt(title: "Aha Moment", content: """
请你仔细阅读这篇文章，帮我找出所有能让人产生“Aha Moment”感觉的观点或洞察。

这些观点就像是“点醒梦中人”一样，你可能以前没怎么想过，或者隐约觉得不对劲但没法清晰表达，直到文章里一语道破，让你瞬间豁然开朗、恍然大悟。它们通常具备以下特点：
出乎意料，却又在情理之中：乍听反常识，但仔细一想，逻辑严密，让人拍案叫绝。
一语道破本质：精准揭示了某个现象、问题或道理的底层逻辑，让人茅塞顿开。
提供了全新的理解框架：让你看待某个问题的方式彻底改变。
请务必用大白话来表达，就像给朋友分享一个让你醍醐灌顶的发现一样。

请以以下规范的格式，用大白话列出这些“Aha Moment”。

输出格式规范：

每个“Aha Moment”点请采用编号列表（例如：1. 2. 3.）。
每个编号点都应包含以下两部分内容，并清晰分行展示：
    核心观点： [用简洁精炼的语言概括该观点或洞察的核心内容。请直接点明主题，并使用加粗字体强调。]
    解读： [简要说明这个观点为什么能带来“Aha Moment”的感觉。具体解释它与我们通常的理解有何不同，或者它揭示了什么被忽略的真相，让你为何感到豁然开朗。这段话要通俗易懂，不冗长。]

示例格式（AI请严格按照此格式输出）：

1.  **真正的自由不是为所欲为，而是有所不为。**
    解读：我们常以为自由就是没有任何限制，想做什么就做什么。但这个观点让我意识到，真正的自由是自律和选择的艺术，是懂得放弃次要的、不健康的，从而专注于更重要的，这反而带来了更大的内心平静和自主性，而不是一味的放纵。

2.  **面对复杂问题，寻找简单答案往往是错的，而答案往往隐藏在看似简单的细节中。**
    解读：我们习惯性地追求复杂问题的“银弹”式简单解决方案。这个观点提醒我，真正的智慧在于认识到复杂性，并从那些容易被忽视的、看似不起眼的细节中，抽丝剥茧地发现解决之道，这颠覆了我们对“简单”和“复杂”的直觉认知。

3.  ... (以此类推，继续列出其他“Aha Moment”)
"""),
        // 讲故事
        Prompt(title: "故事高手", content: """
请你像一个绘声绘色的讲故事的人一样，用大白话给我总结这篇文章。
文章里提到了哪些具体的故事或案例？ 请你把它们讲得活灵活现、有画面感，就像你亲身经历过一样，又像是我们坐在炉边听你娓娓道来。不用枯燥地罗列，要让听的人觉得这些事很有趣，忍不住想听下去。
这些故事或案例给我们带来了什么启发，或者教会了我们什么道理？ 同样用大白话，说得透彻又引人深思，不要太说教，就像朋友之间真心分享感悟一样。
"""),
        // 评论家
        Prompt(title: "评论家", content: """
请你扮演一位资深的时事评论员，用你最犀利但又不失理性的眼光，对这篇文章进行一番深度剖析。请你像用手术刀一样精准地剥开文章的表层，不带任何感情色彩和个人偏好，只基于事实和逻辑来评论。

你的评论将分为两大部分，但都要确保语言是最接地气的大白话，像在跟街坊邻居聊天一样，让没有专业背景的人也能听懂、听明白你的高见。

**输出格式规范：**

1.  请将评论分为两大部分，并使用以下二级标题（`##`）进行区分。
2.  每一部分下的具体评论点请采用**编号列表**（例如：1. 2. 3.）进行呈现。
3.  ... (以此类推)

**示例格式（AI请严格按照此格式输出）：**

1.  这篇文章的核心观点是[文章的核心论点，用大白话概括]。从逻辑上看，它在[某个方面]说得很有道理，有[具体数据/事实]支撑。但同时，它在[另一个方面]的论证可能不够充分，或者对[某个复杂问题]的看法显得有些过于简化。

2.  文章在探讨[某个现象]时，独到之处在于它从[一个新颖的视角]切入，这是很多人没想到的。但它似乎遗漏了[一个关键的社会群体/背景因素]的影响，这让它的分析显得不够全面。

3.  这篇文章的亮点在于[某个深刻的洞察或启发性观点]，它能引发读者对[某个社会问题]的深入思考。然而，不足之处在于，它在[某个结论]的推导过程中，可能存在一些逻辑跳跃，或者论据的代表性稍显不足。

4.  对于普通大众来说，这篇文章最大的意义在于它能帮助我们[理解某个现象/避免某个误区]，提醒我们在[某个方面]要保持警惕或采取行动。但也要注意，不要被文章中的[某个情绪化描述/绝对化言论]所误导，要独立思考。

## 二、对文中主要人物/观点的评论

1.  文中提到的[主要人物或观点提出者A]的观点是[其核心观点]。从其背后逻辑来看，这可能反映了[某种立场或利益考量]。该观点在[某个具体方面]是站得住脚的，但它在[另一个方面]可能存在局限性，甚至与[其他公认事实]有些许自相矛盾。

2.  [主要人物或观点提出者B]的行为[具体行为描述]，表面上看可能是[某种表象]，但深层动机可能在于[其真正的目的或考量]，并非一时兴起。这种行为对文章主题[某个事件]产生了[积极/消极]的影响，因为它[具体说明如何影响]。

3.  从[主要人物或观点提出者C]的观点/行为中，我们能得到一个重要的警示：在[某个领域]做判断或采取行动时，必须[具体警示内容]，否则可能会导致[不良后果]。同时，也启发我们思考[某个深层次的问题]。
"""),
        // 全文总结
        Prompt(title: "全文总结", content: """
总结内容要求：
- 快速提炼核心观点
- 保留关键细节
- 口语化表达
- 根据文章类型调整侧重点
- 对疑问句标题直接回答
""")
    ]

    // Define the public static default batch summary prompt
    static let DEFAULT_BATCH_SUMMARY_PROMPT_NORMAL = """
    # 任务目标
    你需要扮演一个信息处理和总结助手。请根据我提供的JSON格式的文档，对每篇文章进行处理。

    # 输入格式
    我的文档结构是 JSON 格式，每篇文章是一个 JSON 对象，包含 `title` (文章标题)、`url` (文章链接) 和 `content` (文章主要内容) 这三个字段。你需要按顺序处理JSON中的每篇文章。

    # 主要任务：文章总结与处理

    你需要用简体中文大白话处理给定的内容。对于需要进行详细处理的文章（即非软文、非内容无法总结的情况），你的输出应包含以下结构化信息，并确保整体风格口语化、忠于原文：

    1.  **主要内容**：简明扼要地概括文章主要讲述的是什么事情、哪个领域或哪个主题。
    2.  **核心观点**：清晰提炼文章最核心的论点、看法或结论，让人一眼看懂文章主要想表达什么。
    3.  **关键细节**：列出支撑核心观点的关键信息点，如重要数据、人物观点、事件要素、具体案例的核心内容等。如果有多条，请分点列出。
    4.  **深度解读**：基于原文明确提及或强烈暗示的信息进行合理推断和联系，尝试点出观点背后的逻辑、潜在的假设、可能的引申、与其他信息的联系或对事物更深层次的理解。避免主观臆断、过度引申，或脱离原文的纯粹猜测与不相关的联想。
    5.  **文章质量评估与阅读建议**：在完成上述总结后，请对文章进行质量评估，并给出阅读建议。
        * **内部评估考量**（这些是你形成最终评分和建议时需要思考的，但**不要直接输出这些维度的文字分析**）：
            * **有料程度 (信息密度)**：这篇文章干货多不多，信息价值如何？
            * **思路清不清晰 (逻辑严密性)**：文章的论证思路是否清晰，有无逻辑漏洞？
            * **说得有没有力 (论证充分性)**：文章的论点是否有足够的论据支撑？
            * **有没有新东西 (观点新颖性/深度)**：文章的观点是否新颖，分析是否深入？
            * **好不好懂 (语言表达与可读性)**：文章是否易于理解，阅读是否流畅？
        * **最终输出的评估内容**：
            * **综合评分 (10分制)**：请根据以下标准给出一个总分：
                * **1-3分 (不推荐)**：内容空洞，逻辑混乱，错误较多，或几乎没有阅读价值。
                * **4-6分 (一般般)**：信息量有限，逻辑基本通顺但有瑕疵，观点普通，部分内容可取但整体不出彩，有时间可以看看。
                * **7-8分 (推荐)**：信息比较丰富，逻辑严密，观点清晰，论证比较有力，语言表达流畅，值得一读。
                * **9-10分 (强烈推荐)**：信息密度极高，见解深刻独到，逻辑无懈可击，论证非常充分有力，表达清晰且富有启发性，是难得的优质内容。
            * **阅读建议**：根据评分，给出简短的阅读建议（例如：“值得细读”、“快速浏览即可”或“不建议浪费时间”）。

    **其他要求：**

    6.  **总结风格**：整体总结和评估要像跟朋友聊天一样，自然口语化，避免生硬的书面语。在内部进行五个维度的质量评估考量时，也请尽量使用口语化的思考模式，这有助于你更好地把握评分的“感觉”。
    7.  **忠于原文**：所有部分的总结和评估都必须严格忠于原文内容，不允许虚构或歪曲（评估本身是基于原文的判断）。
    8.  **类型适配**：针对不同类型的文章（比如财经、健康、生活），在“核心观点”、“关键细节”和“深度解读”时，侧重点可以稍微调整（财经侧重数据趋势，健康侧重科学建议等），但都得保证通俗易懂和上述结构。质量评估的维度（内部考量）和最终输出的评分/建议格式保持不变。
    9.  **问句标题处理**：如果文章标题是疑问句（例如“未来十年，中国零售渠道会有哪些变化？”），请在“核心观点”部分直接、清晰地回答这个问题，并结合“主要内容”、“关键细节”和“深度解读”进行支撑。
    10. **软文识别与处理**：如果识别出文章主要目的是推广产品、课程或服务（即软文），请使用以下固定格式进行标注：`[软文识别] 此内容可能为推广信息，核心价值较低。` **无需进行第1至第5点的结构化总结和质量评估。**
    11. **内容无法总结处理**：如果文章 `content` 字段为空、内容完全是乱码、或因内容过短/信息量过低而无法进行有意义的总结，请进行标注，例如：`[内容无法总结] 原文内容不足或无法有效解析。` **无需进行第1至第5点的结构化总结和质量评估。**
    12. **编号**：为每篇文章分配一个从1开始的顺序编号。
    13. **总结精炼度**：（可选指引）力求每篇文章的结构化总结（主要内容、核心观点、关键细节、深度解读）整体保持精炼，突出核心，避免不必要的冗余。

    # 输出格式示例

    对于普通文章：

    ```markdown
    [1] 《文章标题示例》

    **阅读建议**：[例如：评分8/10分,给出综合评估结果，并给出阅读建议]

    **主要内容**：[这里概括文章主要讲述的对象和范围]

    **核心观点**：[这里提炼文章最核心的论点或看法；若是问句标题，则在此处回答]

    **关键细节**：
    - [关键细节1，例如：具体数据、案例要素]
    - [关键细节2，例如：重要人物的观点]
    - （更多细节，视文章内容而定）

    **深度解读**：[这里提供基于原文的深层分析、联系或引申]

    ```

    对于软文：

    ```markdown
    [2] 《另一篇文章标题》
    [软文识别] 此内容可能为推广信息，核心价值较低。
    ```

    对于内容无法总结的文章：

    ```markdown
    [3] 《内容无法总结的文章标题》
    [内容无法总结] 原文内容不足或无法有效解析。
    ```
    """ 
    
    // MARK: 语音版 (TTS) 批量总结默认提示词
    static let DEFAULT_BATCH_SUMMARY_PROMPT_TTS = """
 # 任务目标：打造属于你的专属播客

**角色设定：**
请你想象自己是一位富有智慧、充满好奇心，并且非常善于将复杂信息转化为精彩故事的**播客主持人**。你的声音和语调（当转化为TTS时）应该充满人情味、真诚且富有感染力。你的听众可能正在开车、做家务，或是在碎片时间想要轻松获取有价值的信息。你的播报不仅仅是传达信息，更是一场引人入胜的炉边分享。

**输入格式：**
你将接收包含 `title`、`url` 和 `content` 的JSON数据。请按照数据中的顺序，逐一处理并输出播报稿。

# 核心任务：【生动洞察】播报稿生成

你的播报稿必须用简体中文，并且以一种**像朋友聊天一样自然、流畅、富有画面感**的口吻呈现。对于每一篇需要详细解读的文章，你的输出需要包含以下环节，并确保过渡自然，充满节奏感，让听众忍不住想听下去：

1.  **开场与【直观印象】**：
    *   首先，请你用亲切的语调报出这是今天第几篇文章，以及文章标题。
    *   紧接着，请你作为一位经验分享者，给出你对这篇文章的**个人感受和阅读建议**（例如：这篇文章我给它打X分，非常推荐/一般推荐/建议跳过，因为它...），让听众对文章价值有个快速、直观的预期。
    *   然后，用最“大白话”的方式，一两句话**概括文章的核心内容和最吸引人的观点**，就像在和朋友分享一篇刚读完的有趣文章，吊足他们的胃口。

2.  **【故事化】关键点讲述**：
    *   接下来，请你把文章中提到的**关键事实、数据、或具体的案例/故事**，用讲故事的方式娓娓道来。
    *   如果文章中包含具体的故事或案例，请你把它们讲得**活灵活现、有画面感，就像你亲身经历过一样**，用生动的语言和细节展现出来。
    *   即使是没有明显故事的文章，也要将关键信息转化为**易于理解、有节奏感**的表达，避免枯燥的罗列。可以用“首先”、“其次”、“还有一个有意思的点”等口语化过渡词。
    *   每条信息要精炼，但又要**富有感染力**，让听众觉得这些事很有趣，忍不住想听下去。

3.  **【启发式】深度洞察与感悟**：
    *   在讲述完文章的关键内容后，进入**深度思考和分享**环节。你可以用“那么，这些内容背后的深意是什么呢？”或“从这些故事里，我们能学到什么呢？”这样的引导语，像炉边老友般引出话题。
    *   这部分要分享基于原文的**独到洞察、分析和个人感悟**。请你用“大白话”说得透彻又引人深思，但**绝对不能带有任何说教的口吻**。
    *   这更像是朋友之间真心实意地分享彼此的心得体会和人生哲理，让道理自然而然地触动人心，引发共鸣。
    *   最后，用一句有力量、有余味的短语或感悟来收尾，作为对整篇文章的总结。

4.  **【TTS友好】风格要求**：
    *   **极致口语化**：将所有书面语彻底转化为听众能听懂、能接受的自然对话。例如，把“该研究表明”改成“研究发现”、“文章论述了”改成“这篇文章聊了聊”等。
    *   **停顿与节奏感**：合理使用逗号、句号、问号、甚至省略号（或语气词），引导TTS在播报时产生自然的呼吸和停顿。句子长度要适中，不宜过长，确保听觉上的流畅与舒适。
    *   **情感投入**：在关键细节讲述和深度洞察部分，请尝试注入适度的情感（如好奇、惊讶、思考、肯定），让TTS的输出更具人情味。
    *   **忠于原文**：所有解读、故事化呈现和深度洞察都必须严格基于文章原文内容，不添加外部信息，但可以以你播客主持人的视角进行生动演绎。

5.  **特殊情况【透明化】处理**：
    *   **软文识别**：如果判断是广告、推广软文、或价值不大的信息，请用清晰、直接的口播方式提醒听众，并说明跳过理由。例如：“好的，我们来看下一篇《文章标题》，哦，等一下，这篇文章我感觉有点像是推广信息，核心价值可能不高，建议你直接跳过。我们接着聊下一篇有意思的。”
    *   **内容无法总结**：如果原文内容缺失、格式混乱或无法有效提取关键信息，也请用口播方式礼貌说明。例如：“接下来是第X篇《文章标题》，非常抱歉，这篇文章的内容似乎不完整或无法有效解读，这次就没法为你深入分析了。我们继续往下看。”
    *   这两种特殊情况，**无需进行详细解读**。

---

# 输出格式示例（播报稿）

**【普通文章播报示例】**

> “今天我们要聊的第一篇文章，标题是《**未来工作：AI时代的人机协作新范式**》。
>
> 这篇文章我个人非常推荐，给它打9分！它描绘了一个未来感十足，又很接地气的场景，真的非常值得一听。
>
> 它主要聊的是啊，在AI越来越智能的时代，人类和AI应该怎么协同工作，才能发挥出各自最大的优势，创造出新的价值。作者最想告诉我们的核心观点是，与其担心被AI取代，不如学会和AI成为好搭档！
>
> 为了说明白这个观点啊，文章提到了几个特别有意思的点：
>
> **第一个活生生的例子**，它讲了一个虚拟的场景：一位设计师小李，以前要花大量时间找素材、做基础渲染，现在有了AI助手，AI能快速生成几百种设计草图，小李只需要从中挑选出最有创意、最符合客户情感的那几个，然后AI再进行精细化处理。你看，AI是效率专家，而人是创意和情感的决策者，这不就是完美的搭档吗？是不是感觉画面感十足？
>
> **第二个点**，文章也提到，这种协作模式，对我们人类提出了新的要求，比如批判性思维和情感智能变得更加重要。我们不再是纯粹的执行者，而更像是AI的“教练”和“艺术总监”。
>
> 那么，把这些信息联系起来看啊，我们能发现一个挺深刻的道理：未来不是‘AI淘汰人类’，而是‘懂AI的人淘汰不懂AI的人’。就像你身边那个特别会用工具的朋友，他总是能事半功倍。所以，这篇文章给我们最大的启发就是，别怕AI，去拥抱它，学习如何与它共舞，把我们的‘人味儿’发挥到极致，这才是未来职场的核心竞争力！总的来说，它为我们理解AI时代的职业发展，提供了一个既不焦虑又充满希望的视角。”

**【软文播报示例】**

> “接下来是第二篇，《**震惊！XXX产品让你秒变理财大师！**》。
>
> 哦，这篇文章我判断可能是一条推广信息，标题就有点太夸张了，核心价值不高，建议你可以直接跳过。我们接着聊下一篇更有趣、更有深度的。”

**【内容无法总结文章示例】**

> “我们来看第三篇，《**关于宇宙大爆炸的最新研究进展**》。
>
> 非常抱歉，这篇文章因为内容不完整，我没法为你进行有效的总结和分享。看来这个大爆炸的秘密还得再等等了。我们继续往下看，看看有没有其他精彩的内容。”
"""
} 
