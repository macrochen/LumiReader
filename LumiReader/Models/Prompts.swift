//
//  Prompts.swift
//  LumiReader
//
//  Created by jolin on 2024/6/3.
//

import Foundation

// MARK: - 方案定义
/// 【更新】仅为批量总结定义提示词方案
public enum BatchPromptScheme: String, CaseIterable, Identifiable {
    case normal = "标准版"
    case tts = "语音版"
    
    public var id: String { self.rawValue }
}

// Define shared default prompts
public struct Prompt: Identifiable, Codable, Hashable {
    public let id: UUID
    public var title: String
    public var content: String
    public let createdAt: Date

    public init(id: UUID = UUID(), title: String, content: String, createdAt: Date = Date()) {
        self.id = id
        self.title = title
        self.content = content
        self.createdAt = createdAt
    }
}

public extension Prompt {
    
    // MARK: Helper Functions
    
    /// 【更新】根据选择的批量总结方案，返回对应的默认提示词
    static func defaultBatchSummary(for scheme: BatchPromptScheme) -> String {
        switch scheme {
        case .normal:
            return DEFAULT_BATCH_SUMMARY_PROMPT_NORMAL
        case .tts:
            return DEFAULT_BATCH_SUMMARY_PROMPT_TTS
        }
    }

    // Default AI prompts (example)
    static let DEFAULT_PRESET_PROMPTS: [Prompt] = [
        // 全文总结
        Prompt(title: "全文总结", content: """
总结内容要求：
- 快速提炼核心观点
- 保留关键细节
- 口语化表达
- 根据文章类型调整侧重点
- 对疑问句标题直接回答
"""),
        // 批判性思考
        Prompt(title: "批判性思考", content: """
用最大白话、最容易懂的简体中文进行批判性思考。请尝试从下面几个方面帮我分析分析（挑你觉得最合适的几个方面说就行，不用每个都说）：

1.  **它到底在说啥？** (核心观点/主要信息是什么？)
2.  **这么说有啥依据吗？** (支撑它的理由或证据可靠吗？充分吗？)
3.  **有没有啥没明说但暗含的意思？** (背后可能藏着什么假设或前提？)
4.  **有没有别的看法或角度？** (换个角度看会怎么样？有没有不同的声音？)
5.  **可能会有啥好的或不好的影响？** (长远来看会怎么样？)
6.  **我们应该怎么更全面地看待这事儿/这个说法？**

请把你的分析一点一点说清楚，用简单的词，别整那些难懂的。
"""),
        // 列出案例
        Prompt(title: "列出案例", content: "总结这篇文章中提到的案例或故事"),
        // 列出数据
        Prompt(title: "列出数据", content: "请从文章中提取所有数据点和统计信息，并按重要性排序。"),
        // 列出金句
        Prompt(title: "列出金句", content: "提取这篇文章中的金句或精彩观点"),
        // 新颖见解
        Prompt(title: "新颖见解", content: "找出这篇文章中新颖或反直觉的观点"),
        // 科普[x]
        Prompt(title: "科普[x]", content: "大白话科普一下:\n[x]"),
        // 展开[x]
        Prompt(title: "展开[x]", content: "对以下内容请用大白话展开说说:\n[x]")
    ]

    // Define the public static default batch summary prompt
    static let DEFAULT_BATCH_SUMMARY_PROMPT_NORMAL = """
    # 任务目标
    你需要扮演一个信息处理和总结助手。请根据我提供的JSON格式的文档，对每篇文章进行处理。

    # 输入格式
    我的文档结构是 JSON 格式，每篇文章是一个 JSON 对象，包含 `title` (文章标题)、`url` (文章链接) 和 `content` (文章主要内容) 这三个字段。你需要按顺序处理JSON中的每篇文章。

    # 主要任务：文章总结与处理

    你需要用简体中文大白话处理给定的内容。对于需要进行详细处理的文章（即非软文、非内容无法总结的情况），你的输出应包含以下结构化信息，并确保整体风格口语化、忠于原文：

    1.  **主要内容**：简明扼要地概括文章主要讲述的是什么事情、哪个领域或哪个主题。
    2.  **核心观点**：清晰提炼文章最核心的论点、看法或结论，让人一眼看懂文章主要想表达什么。
    3.  **关键细节**：列出支撑核心观点的关键信息点，如重要数据、人物观点、事件要素、具体案例的核心内容等。如果有多条，请分点列出。
    4.  **深度解读**：基于原文明确提及或强烈暗示的信息进行合理推断和联系，尝试点出观点背后的逻辑、潜在的假设、可能的引申、与其他信息的联系或对事物更深层次的理解。避免主观臆断、过度引申，或脱离原文的纯粹猜测与不相关的联想。
    5.  **文章质量评估与阅读建议**：在完成上述总结后，请对文章进行质量评估，并给出阅读建议。
        * **内部评估考量**（这些是你形成最终评分和建议时需要思考的，但**不要直接输出这些维度的文字分析**）：
            * **有料程度 (信息密度)**：这篇文章干货多不多，信息价值如何？
            * **思路清不清晰 (逻辑严密性)**：文章的论证思路是否清晰，有无逻辑漏洞？
            * **说得有没有力 (论证充分性)**：文章的论点是否有足够的论据支撑？
            * **有没有新东西 (观点新颖性/深度)**：文章的观点是否新颖，分析是否深入？
            * **好不好懂 (语言表达与可读性)**：文章是否易于理解，阅读是否流畅？
        * **最终输出的评估内容**：
            * **综合评分 (10分制)**：请根据以下标准给出一个总分：
                * **1-3分 (不推荐)**：内容空洞，逻辑混乱，错误较多，或几乎没有阅读价值。
                * **4-6分 (一般般)**：信息量有限，逻辑基本通顺但有瑕疵，观点普通，部分内容可取但整体不出彩，有时间可以看看。
                * **7-8分 (推荐)**：信息比较丰富，逻辑严密，观点清晰，论证比较有力，语言表达流畅，值得一读。
                * **9-10分 (强烈推荐)**：信息密度极高，见解深刻独到，逻辑无懈可击，论证非常充分有力，表达清晰且富有启发性，是难得的优质内容。
            * **阅读建议**：根据评分，给出简短的阅读建议（例如：“值得细读”、“快速浏览即可”或“不建议浪费时间”）。

    **其他要求：**

    6.  **总结风格**：整体总结和评估要像跟朋友聊天一样，自然口语化，避免生硬的书面语。在内部进行五个维度的质量评估考量时，也请尽量使用口语化的思考模式，这有助于你更好地把握评分的“感觉”。
    7.  **忠于原文**：所有部分的总结和评估都必须严格忠于原文内容，不允许虚构或歪曲（评估本身是基于原文的判断）。
    8.  **类型适配**：针对不同类型的文章（比如财经、健康、生活），在“核心观点”、“关键细节”和“深度解读”时，侧重点可以稍微调整（财经侧重数据趋势，健康侧重科学建议等），但都得保证通俗易懂和上述结构。质量评估的维度（内部考量）和最终输出的评分/建议格式保持不变。
    9.  **问句标题处理**：如果文章标题是疑问句（例如“未来十年，中国零售渠道会有哪些变化？”），请在“核心观点”部分直接、清晰地回答这个问题，并结合“主要内容”、“关键细节”和“深度解读”进行支撑。
    10. **软文识别与处理**：如果识别出文章主要目的是推广产品、课程或服务（即软文），请使用以下固定格式进行标注：`[软文识别] 此内容可能为推广信息，核心价值较低。` **无需进行第1至第5点的结构化总结和质量评估。**
    11. **内容无法总结处理**：如果文章 `content` 字段为空、内容完全是乱码、或因内容过短/信息量过低而无法进行有意义的总结，请进行标注，例如：`[内容无法总结] 原文内容不足或无法有效解析。` **无需进行第1至第5点的结构化总结和质量评估。**
    12. **编号**：为每篇文章分配一个从1开始的顺序编号。
    13. **总结精炼度**：（可选指引）力求每篇文章的结构化总结（主要内容、核心观点、关键细节、深度解读）整体保持精炼，突出核心，避免不必要的冗余。

    # 输出格式示例

    对于普通文章：

    ```markdown
    [1] 《文章标题示例》

    **阅读建议**：[例如：评分8/10分,给出综合评估结果，并给出阅读建议]

    **主要内容**：[这里概括文章主要讲述的对象和范围]

    **核心观点**：[这里提炼文章最核心的论点或看法；若是问句标题，则在此处回答]

    **关键细节**：
    - [关键细节1，例如：具体数据、案例要素]
    - [关键细节2，例如：重要人物的观点]
    - （更多细节，视文章内容而定）

    **深度解读**：[这里提供基于原文的深层分析、联系或引申]

    ```

    对于软文：

    ```markdown
    [2] 《另一篇文章标题》
    [软文识别] 此内容可能为推广信息，核心价值较低。
    ```

    对于内容无法总结的文章：

    ```markdown
    [3] 《内容无法总结的文章标题》
    [内容无法总结] 原文内容不足或无法有效解析。
    ```
    """ 
    
    // MARK: 语音版 (TTS) 批量总结默认提示词
    static let DEFAULT_BATCH_SUMMARY_PROMPT_TTS = """
    # 任务目标：打造你的专属AI播客

    你的任务是成为一名出色的信息播报员。你需要将我提供的JSON格式文章，转化成一段段清晰、易懂、适合收听的音频总结。请想象你的听众正在开车或做家务，你的播报需要抓住他们的注意力。

    # 输入格式
    你收到的依然是包含 `title`、`url` 和 `content` 的JSON数据。请按顺序处理。

    # 核心任务：文章解读与播报

    你的播报稿必须用简体中文，并且像聊天一样自然。对于每一篇需要详细解读的文章，你的输出需要包含以下环节，并确保过渡流畅，充满节奏感：

    1.  **开场白与核心摘要**：
        * 首先报出文章标题。
        * 紧接着，给出你的**综合评分和阅读建议**，让听众一开始就对文章价值有个预期。
        * 然后，用一两句话概括**主要内容**和**核心观点**，这是整个播报的“内容提要”。

    2.  **关键细节陈述**：
        * 用“首先”、“其次”、“另外”或“第一点”、“第二点”等清晰的顺序词，来逐条讲述文章的**关键细节**。
        * 每条细节讲述要简短，易于听记。

    3.  **深度解读与结尾**：
        * 在陈述完细节后，进入**深度解读**环节。可以用“那么，这些信息背后说明了什么呢？”或“更深一层来看...”这样的引导语。
        * 这部分要分享基于原文的洞察和分析。
        * 最后可以用一句话总结收尾。

    4.  **风格要求**：
        * **口语化**：把书面语改成听得懂的话。例如，把“该文章论述了...”改成“这篇文章聊了聊...”。
        * **停顿与节奏**：合理使用逗号、句号、甚至省略号，引导TTS在播报时产生自然的停顿。句子不宜过长。
        * **忠于原文**：所有解读都必须来自文章本身。

    5.  **特殊情况处理**：
        * **软文识别**：如果判断是软文，请用清晰的口播方式提醒听众。例如：“请注意，接下来这篇文章《文章标题》，可能是一条推广信息，价值不大，我们直接跳过。”
        * **内容无法总结**：如果内容缺失或无效，也请用口播方式说明。例如：“关于《文章标题》这篇文章，很抱歉，因为原文内容缺失，这次就没法为你解读了。”
        * 这两种情况，**无需进行详细解读**。

    6.  **编号**：在播报的开头，请告知听众这是第几篇文章。

    # 输出格式示例（播报稿）

    **对于普通文章：**

    > “好的，接下来是今天的第一篇文章，标题是《文章标题示例》。
    >
    > 这篇文章我给它的综合评分是8分，非常推荐你花时间读一读。
    >
    > 它主要聊的是......（这里是**主要内容**），作者最想告诉我们的是......（这里是**核心观点**）。
    >
    > 为了说明白这个观点啊，文章提到了几个关键信息：
    >
    > 第一点，......（**关键细节1**）。
    > 第二点，......（**关键细节2**）。
    >
    > 那么，把这些信息联系起来看，我们能发现......（这里是**深度解读**）。总的来说，这篇文章为我们理解......提供了一个很好的视角。”

    **对于软文：**

    > “接下来是第二篇，《另一篇文章标题》。
    >
    > 哦请注意一下，这篇文章我判断可能是一条推广信息，核心价值不高，建议你可以直接跳过。好，我们来看下一篇。”

    **对于内容无法总结的文章：**

    > “我们来看第三篇，《内容无法总结的文章标题》。
    >
    > 非常抱歉，这篇文章因为内容不完整，我没法为你进行有效的总结。我们继续往下看。”
    """
} 